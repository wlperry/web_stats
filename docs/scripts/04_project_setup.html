<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>2024_r_stats - Project Management</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">2024_r_stats</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../scripts/index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../scripts/about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#designing-a-project-from-the-ground-up." id="toc-designing-a-project-from-the-ground-up." class="nav-link active" data-scroll-target="#designing-a-project-from-the-ground-up.">Designing a project from the ground up.</a>
  <ul class="collapse">
  <li><a href="#steps-to-consider" id="toc-steps-to-consider" class="nav-link" data-scroll-target="#steps-to-consider">Steps to consider</a></li>
  <li><a href="#data-source-format" id="toc-data-source-format" class="nav-link" data-scroll-target="#data-source-format">Data Source Format</a>
  <ul class="collapse">
  <li><a href="#controlled-vocabulary-and-units" id="toc-controlled-vocabulary-and-units" class="nav-link" data-scroll-target="#controlled-vocabulary-and-units">Controlled vocabulary and units</a></li>
  <li><a href="#variable-names" id="toc-variable-names" class="nav-link" data-scroll-target="#variable-names">Variable names</a></li>
  <li><a href="#transformations" id="toc-transformations" class="nav-link" data-scroll-target="#transformations">Transformations</a></li>
  <li><a href="#data-structure-and-format" id="toc-data-structure-and-format" class="nav-link" data-scroll-target="#data-structure-and-format">Data structure and format</a></li>
  <li><a href="#wide-format-original-data" id="toc-wide-format-original-data" class="nav-link" data-scroll-target="#wide-format-original-data">Wide format original data</a></li>
  <li><a href="#output" id="toc-output" class="nav-link" data-scroll-target="#output">Output</a></li>
  </ul></li>
  <li><a href="#data-flow" id="toc-data-flow" class="nav-link" data-scroll-target="#data-flow">Data Flow</a></li>
  <li><a href="#project-directory-structure" id="toc-project-directory-structure" class="nav-link" data-scroll-target="#project-directory-structure">Project directory structure</a></li>
  <li><a href="#file-names" id="toc-file-names" class="nav-link" data-scroll-target="#file-names">File names</a></li>
  <li><a href="#annotations-and-metadata-files" id="toc-annotations-and-metadata-files" class="nav-link" data-scroll-target="#annotations-and-metadata-files">Annotations and metadata files</a></li>
  <li><a href="#rstudio-specifics" id="toc-rstudio-specifics" class="nav-link" data-scroll-target="#rstudio-specifics">RStudio Specifics</a>
  <ul class="collapse">
  <li><a href="#outline-your-code-to-navigate" id="toc-outline-your-code-to-navigate" class="nav-link" data-scroll-target="#outline-your-code-to-navigate">Outline your code to navigate</a></li>
  <li><a href="#comment-your-code" id="toc-comment-your-code" class="nav-link" data-scroll-target="#comment-your-code">Comment your code</a></li>
  </ul></li>
  <li><a href="#installing-r" id="toc-installing-r" class="nav-link" data-scroll-target="#installing-r">Installing R</a>
  <ul class="collapse">
  <li><a href="#r-interface" id="toc-r-interface" class="nav-link" data-scroll-target="#r-interface">R interface</a></li>
  <li><a href="#project-setup" id="toc-project-setup" class="nav-link" data-scroll-target="#project-setup">Project Setup</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Project Management</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="designing-a-project-from-the-ground-up." class="level1">
<h1>Designing a project from the ground up.</h1>
<section id="steps-to-consider" class="level2">
<h2 class="anchored" data-anchor-id="steps-to-consider">Steps to consider</h2>
<p>So the first thing to think about in my opinion is the workflow or dataflow:</p>
<ol type="1">
<li>What is the source and format of your data?
<ul>
<li>what are the variables and units and how will you name them<br>
</li>
<li>controlled vocabulary list<br>
</li>
<li>data structure in columns<br>
</li>
</ul></li>
<li>What is the final objective and use of your data and what output?
<ul>
<li>what is the most flexible output<br>
</li>
<li>graphs<br>
</li>
<li>summary statistics<br>
</li>
<li>statistical analyses<br>
</li>
</ul></li>
<li>What is the flow of data
<ul>
<li>source and update frequency</li>
<li>QA/QC and flagging of data</li>
<li>Transformations or calculations to be made</li>
<li>Final data output for use - note never write to original dataframe</li>
<li>Summary statistics</li>
<li>Graphs</li>
<li>Statistical Analyses</li>
<li>Reports with markdown</li>
<li>Annotate scripts and metadata<br>
</li>
</ul></li>
<li>Set up directory structure
<ul>
<li>R Project Directory
<ul>
<li>scripts/code</li>
<li>documents</li>
<li>data</li>
<li>figures / output</li>
<li>finalized_data</li>
</ul></li>
</ul></li>
</ol>
</section>
<section id="data-source-format" class="level2">
<h2 class="anchored" data-anchor-id="data-source-format">Data Source Format</h2>
<section id="controlled-vocabulary-and-units" class="level3">
<h3 class="anchored" data-anchor-id="controlled-vocabulary-and-units">Controlled vocabulary and units</h3>
<p>Thinking about your data source first is important. Using a controlled vocabulary that references names of variables the same from project to project is critical. Defining these in a metadata document with the vocabulary and the units for each term so that future users can figure out what your codes mean is also useful.</p>
</section>
<section id="variable-names" class="level3">
<h3 class="anchored" data-anchor-id="variable-names">Variable names</h3>
<p>As part of controlled vocabulary, the way you type the variable names is also important and also important to be consistent. I have found <strong>snake case</strong> to be the best for me and using the package <strong>Janitor</strong> works well to fix messy file names. The main problem is variable names with spaces requires back ticks (<code>variable name</code>) to use them and special characters (`!@#$%^&amp;* and u(micro) etc.) are coded differently on different operating systems and create chaos. The different styles are below:</p>
<ol type="1">
<li>snake case - looks_like_this - separated by _ and all lower case and often most popular</li>
<li>period separated - looks.like.this - separated by periods - may get confused with other commands</li>
<li>lower camel case - looksLikeThis - ever word is capitilized after the first - often harder to type with all the shift caps</li>
<li>upper camel case - LooksLikeThis - all words capitilized</li>
<li>all lower case - lookslikethis - I find it messy and hard to read</li>
</ol>
<p>the key is that you should have no spaces or special characters. If you do have spaces you use the back tick <strong><code>abc xyz</code></strong> on either side of the variable to call it.</p>
<p>Special characters are often coded differently in mac and pc computers and will cause more headaches than you have after St.&nbsp;Patricks Day.</p>
</section>
<section id="transformations" class="level3">
<h3 class="anchored" data-anchor-id="transformations">Transformations</h3>
<p>Keeping a list of transformations and conversions can be helpful in coding and if it is in the meta data file, you can copy the transformations out of the document and if there are mistakes people can track it down fast.</p>
</section>
<section id="data-structure-and-format" class="level3">
<h3 class="anchored" data-anchor-id="data-structure-and-format">Data structure and format</h3>
<p>R uses a column format and all the data in a column has to be of the same type. You can, however, reference data by row and column as in excel.</p>
<p>The most common data formats you will run into are:</p>
<ul>
<li><p>Numeric - can be double or integer but that is not as important</p></li>
<li><p>Character - text fields</p></li>
<li><p>Factors - displayed often as text but is as levels behind the scenes</p></li>
<li><p>Date - date format or PosixLt or Date</p>
<ul>
<li>note this is in days since 1970-01-01 I believe</li>
</ul></li>
<li><p>Date time - date and time format together or PosixCt</p>
<ul>
<li>this is in seconds since 1970-01-01 00:00:00</li>
<li>this will be critical for many of you</li>
</ul>
<p><strong>Note that if you mix formats within a column some of the variables will be converted to NA if say you have a column that is a character column which has mixed numbers and text and is then converted to numeric</strong></p></li>
</ul>
</section>
<section id="wide-format-original-data" class="level3">
<h3 class="anchored" data-anchor-id="wide-format-original-data">Wide format original data</h3>
<p>Typically when we enter data it is in <strong>wide format</strong> where an identifier is in the first column and the various variables are in separate columns. This is what is often easiest to enter into excel or wherever it is entered originally.</p>
<p>This format is often more difficult to work with in R and GGPlot so it is converted to <strong>long format</strong> where there is a column of identifiers, a column of variable names, and a column of values. The switch between these formats is often rather easy so it does not matter what format it is in.</p>
<p>wide format:<br>
For the M&amp;M data set this would look like:<br>
Columns across the top would be:</p>
<ul>
<li>center - type of center - peanut or chocolate etc</li>
<li>color - the outter shell color</li>
<li>diameter - the size</li>
<li>mass - the weight</li>
</ul>
<p>long format:<br>
This would condense this format to fewer columns repeating center and color and have a column called dimension and one called values. The dimension would be diameter or mass and the value woudl be the value. This is not that effective in this small data set but it invalualbe in larger data sets. It also makes summary stats and graphing easier:</p>
<ul>
<li>center - type of center - peanut or chocolate etc</li>
<li>color - the outer shell color</li>
<li>dimension - diameter or mass</li>
<li>value - either the diameter or weight</li>
</ul>
</section>
<section id="output" class="level3">
<h3 class="anchored" data-anchor-id="output">Output</h3>
<p>I find it useful to maintain a read only file of the original data and never write to this file other than the original QA/QC flagging of the data if even then. I usually read from this file and save it to the finalized data folder where the data has been cleaned formatted and basic calculations done on it.</p>
</section>
</section>
<section id="data-flow" class="level2">
<h2 class="anchored" data-anchor-id="data-flow">Data Flow</h2>
<p>It is often very helpful prior to doing any code work to think about what the final output will look like and what the original data looks like and the steps between these two points.</p>
</section>
<section id="project-directory-structure" class="level2">
<h2 class="anchored" data-anchor-id="project-directory-structure">Project directory structure</h2>
<p>Having a consistent project directory structure where code, data, and text is stored makes it easy to look at different directories and find what you are looking for. That is why I use the following structure. Choose what works for you and stick with it… please</p>
<blockquote class="blockquote">
<h3 id="directory-listing" class="anchored">Directory Listing</h3>
<ul>
<li>r_projects
<ul>
<li>scripts</li>
<li>documents</li>
<li>data</li>
<li>figures or output</li>
<li>final_data</li>
</ul></li>
</ul>
</blockquote>
<p>Using projects in R is super useful and you don’t have to worry about setting directories (setwd(*C:*)) between a mac and windows machine and all the paths are relative in there when you reference data or output directories and is the same on windows and mac.</p>
</section>
<section id="file-names" class="level2">
<h2 class="anchored" data-anchor-id="file-names">File names</h2>
<p>From the site <a href="https://andrewbtran.github.io/NICAR/2018/workflow/docs/01-workflow_intro.html?utm_content=buffer858fd&amp;utm_medium=social&amp;utm_source=twitter.com&amp;utm_campaign=buffer">File organization and best practices</a> and <a href="https://kkulma.github.io/2018-03-18-Prime-Hints-for-Running-a-data-project-in-R/">Prime Hints</a> naming files has many good practices. Of these the main theme is:</p>
<ol type="1">
<li>Use a consistent naming theme
<ol type="a">
<li>use date_term1_term2.xxx</li>
<li>no spaces or other fancy characters</li>
<li>make the names human understandable</li>
</ol></li>
<li>Use natural ordering of files
<ol type="a">
<li>use date at front or somewhere so you know the version</li>
<li>use logical ordering like 01_ 02_ 03_</li>
</ol></li>
<li>Avoid things like
<ol type="a">
<li>final thesis proposal.docx - I deal with many students and this is not helpful</li>
</ol></li>
</ol>
</section>
<section id="annotations-and-metadata-files" class="level2">
<h2 class="anchored" data-anchor-id="annotations-and-metadata-files">Annotations and metadata files</h2>
<p><strong>For the love of all that is good</strong> - be sure to annotate you code using the <code>#</code> and whatever text helps describe the process you are doing - it will make the code easier to read and evaluate later when you are trying to figure out something really fast. You can also use it to search for code snippets as you are going along.</p>
<p>Metadata files that document what you are doing and why and what the various conversions and statistical transformations are can be of great use later on as well. It is often challenging to figure out what the units are in for various variables or what they actually mean.</p>
</section>
<section id="rstudio-specifics" class="level2">
<h2 class="anchored" data-anchor-id="rstudio-specifics">RStudio Specifics</h2>
<section id="outline-your-code-to-navigate" class="level3">
<h3 class="anchored" data-anchor-id="outline-your-code-to-navigate">Outline your code to navigate</h3>
<p>You can write a comment <code>#</code> and then follow it with <code>text</code> and then 4 dashes <code>----</code> or <code>####</code> and it will create a note in the outline view</p>
</section>
<section id="comment-your-code" class="level3">
<h3 class="anchored" data-anchor-id="comment-your-code">Comment your code</h3>
<p>You should use comments <code>#</code> with text behind it to annotate the purpose of what your are doing and what is happening in the code chunk below.</p>
</section>
</section>
<section id="installing-r" class="level2">
<h2 class="anchored" data-anchor-id="installing-r">Installing R</h2>
<p>So lets start installing R and R studio<br>
R is its own program and can be retrieved from <a href="https://cran.r-project.org/">R Cran</a><br>
<br>
R Studio is a program that makes the interface and usability of R easier in my opinion and can be retrieved here <a href="https://www.rstudio.com/products/rstudio/download/">R Studio</a></p>
<p>When you get these installed we can load up R studio and look at the interface.</p>
<section id="r-interface" class="level3">
<h3 class="anchored" data-anchor-id="r-interface">R interface</h3>
<p>Start R studio and you should see:</p>
<p><img src="images/rstudio_1.png" class="img-fluid"></p>
</section>
<section id="project-setup" class="level3">
<h3 class="anchored" data-anchor-id="project-setup">Project Setup</h3>
<p>Now to set up a new project in a new directory</p>
<ol type="1">
<li><p>Click File - New Project<br>
<img src="images/rstudio_2.png" class="img-fluid"></p></li>
<li><p>click New Directory<br>
<img src="images/rstudio_3.png" class="img-fluid"></p></li>
<li><p>click New Project<br>
<img src="images/rstudio_4.png" class="img-fluid"></p></li>
<li><p>Then enter the name of the directory you want - Note it is helpful to have a directory of r_projects that you will store all your r projects in.<br>
<img src="images/rstudio_5.png" class="img-fluid"></p></li>
<li><p>Then in the upper right is a name of a project - test in this case - and the files will have the name of the project you will either open when you start RStudio or that you double click to open the project<br>
<img src="images/rstudio_6.png" class="img-fluid"></p></li>
<li><p>Now I typically create directories within this project to organize everything using the following scheme.<br>
<br>
All projects have the same exact set up.</p>
<ul>
<li><p>Scripts - where all the script files go</p></li>
<li><p>Data - where the original data goes and is never written to</p></li>
<li><p>Figures - where you save pdf files of your graphs</p></li>
<li><p>Output - output of modified data</p></li>
<li><p>Documents - documents that relate to the project and meta data if needed</p></li>
<li><p>Themes - a place to store themes for graphs - more later on<br>
<img src="images/rstudio_7.png" class="img-fluid"></p></li>
<li></li>
</ul></li>
<li><p>naming of scripts - note I now name scripts 01_import_and_clean.R and then in order from there in what is done.</p></li>
</ol>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>